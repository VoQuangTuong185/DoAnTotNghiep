<div class="main">
  <div class="cart">
      <p-table [value]="products" [tableStyle]="{ 'min-width': '60rem' }">
          <ng-template pTemplate="caption">
              <div class="flex align-items-center justify-content-between">
                  Products
              </div>
          </ng-template>
          <ng-template pTemplate="header">
              <tr>
                  <th>Image</th>
                  <th>Name</th>                 
                  <th>Category</th>
                  <th>Discount</th>
                  <th>Quantity</th>
                  <th>Price</th>
                  <th style="text-align: center;">Money</th>
                  <th style="text-align: center;">Action</th>
              </tr>
          </ng-template>
          <ng-template pTemplate="body" let-product>
              <tr>
                  <td>
                      <img [src]="createImgPath(product.image)" [alt]="product.productName" width="100" class="shadow-4 product-image" />
                  </td>
                  <td>{{ product.productName }}</td>                 
                  <td>{{ product.categoryName }}</td>
                  <td>{{ product.discount }}%</td>
                  <td>
                      <p-inputNumber
                          [(ngModel)]="product.quanity"
                          [showButtons]="true"
                          buttonLayout="horizontal"
                          inputId="horizontal"
                          spinnerMode="horizontal"
                          [step]="1"
                          decrementButtonClass="p-button-danger"
                          incrementButtonClass="p-button-success"
                          incrementButtonIcon="pi pi-plus"
                          decrementButtonIcon="pi pi-minus"
                          [min]="1"
                          styleClass="input-styling"
                      ></p-inputNumber>
                  </td>
                  <td>{{ product.price | currency : "VND" }}</td>
                  <td style="text-align: center;">
                      <span style="text-decoration: line-through; font-size: small;">{{ product.quanity * product.price | currency : "VND" }}</span>
                      <span style="color: red; font-weight: 600;"> {{ product.quanity * product.price - (product.quanity * product.price * product.discount) / 100 | currency : "VND" }}</span>
                  </td>
                  <td style="text-align: center;">
                      <p-button styleClass="p-button-danger" icon="pi pi-times" (click)="deleteCartItem(product)"></p-button>
                  </td>
              </tr>
          </ng-template>

          <ng-template pTemplate="summary">
              <p style="text-align: center;">Total money : <b style="color: red;">{{ getTotalMoney() | currency : "VND" }}</b></p>
              <button [disabled]="products.length == 0" pButton label="Confirm Order" class="p-button-success btnBuy" (click)="showViewConfirm()"></button>
          </ng-template>
      </p-table>
  </div>

  <form [formGroup]="editUserForm" (ngSubmit)="confirmOrder()">
      <p-dialog [(visible)]="showConfirmOrder" [style]="{ width: '37vw' }" header="Profile Information" [modal]="true" styleClass="p-fluid" class="profile">
          <ng-template pTemplate="content">
              <table>
                  <tr>
                      <td>
                          <div class="mr-5">
                              <mat-form-field appearance="outline">
                                  <mat-label>Name</mat-label>
                                  <input matInput formControlName="Name" name="Name" required="" />
                              </mat-form-field>
                          </div>
                      </td>
                      <td>
                          <div>
                              <mat-form-field appearance="outline">
                                  <mat-label>Email</mat-label>
                                  <input matInput formControlName="Email" name="Email" required="" />
                              </mat-form-field>
                          </div>
                      </td>
                  </tr>
                  <tr>
                      <td>
                          <div class="mr-5">
                              <mat-form-field appearance="outline">
                                  <mat-label>Telephone</mat-label>
                                  <input matInput formControlName="TelNum" name="TelNum" required="" />
                              </mat-form-field>
                          </div>
                      </td>
                      <td>
                          <div>
                              <mat-form-field appearance="fill">
                                  <mat-label>Provinces</mat-label>
                                  <mat-select formControlName="Provinces" (valueChange)="handleChange()" [(value)]="this.existedProvince[0]">
                                      <mat-option *ngFor="let province of provices" [value]="province">
                                          {{ province.name }}
                                      </mat-option>
                                  </mat-select>
                                  <mat-error *ngIf="editUserForm.get('Provinces')?.hasError('required')">
                                      Please choose your province!
                                  </mat-error>
                              </mat-form-field>
                          </div>
                      </td>
                  </tr>
                  <tr>
                      <td>
                          <div class="mr-5">
                              <mat-form-field appearance="fill">
                                  <mat-label>District</mat-label>
                                  <mat-select formControlName="Districts" (valueChange)="handleChange()" [(value)]="this.existedDistrict[0]">
                                      <mat-option *ngFor="let district of districts" [value]="district">
                                          {{ district.name }}
                                      </mat-option>
                                  </mat-select>
                                  <mat-error *ngIf="editUserForm.get('Districts')?.hasError('required')">
                                      Please choose your district
                                  </mat-error>
                              </mat-form-field>
                          </div>
                      </td>
                      <td>
                          <div>
                              <mat-form-field appearance="fill">
                                  <mat-label>Ward</mat-label>
                                  <mat-select formControlName="Wards" (valueChange)="handleChange()" [(value)]="this.existedWard[0]">
                                      <mat-option *ngFor="let ward of wards" [value]="ward">
                                          {{ ward.name }}
                                      </mat-option>
                                  </mat-select>
                                  <mat-error *ngIf="editUserForm.get('Wards')?.hasError('required')">
                                      Please choose your ward!
                                  </mat-error>
                              </mat-form-field>
                          </div>
                      </td>
                  </tr>
                  <tr>
                      <td>
                          <div class="mr-5">
                              <mat-form-field>
                                  <mat-label>House number and street</mat-label>
                                  <textarea matInput rows="1" formControlName="Streets"></textarea>
                                  <mat-error *ngIf="editUserForm.get('Streets')?.hasError('required')">
                                      Please enter your number and street!
                                  </mat-error>
                              </mat-form-field>
                          </div>
                      </td>
                      <td>
                          <mat-form-field>
                              <mat-label>Payment method</mat-label>
                              <mat-select (valueChange)="changeValuePayment($event)" required="" [(value)]="methods[0].key">
                                  <mat-option *ngFor="let method of methods" [value]="method.key">
                                      {{ method.name }}
                                  </mat-option>
                              </mat-select>
                              <mat-error *ngIf="editUserForm.get('Payment')?.hasError('required')">
                                  Please choose payment method!
                              </mat-error>
                          </mat-form-field>
                      </td>
                  </tr>
              </table>
          </ng-template>
          <ng-template pTemplate="footer">
              <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-secondary" type="button" (click)="closeConfirmOrder()"></button>
              <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-success" [disabled]="!editUserForm.valid"></button>
          </ng-template>
      </p-dialog>
  </form>
</div>
